<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Page</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .like-btn { background: #10b981; color: white; border: none; border-radius: 5px; }
        .dislike-btn { background: #ef4444; color: white; border: none; border-radius: 5px; }
        .article-link { color: blue; text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Test Page</h1>
    
    <div class="test-section">
        <h2>LocalStorage Test</h2>
        <button onclick="checkLocalStorage()">Check LocalStorage</button>
        <button onclick="addTestArticle()">Add Test Article</button>
        <button onclick="clearLocalStorage()">Clear LocalStorage</button>
        <div id="localStorageOutput"></div>
    </div>
    
    <div class="test-section">
        <h2>Article Detail Test</h2>
        <button onclick="testArticleDetail()">Test Article Detail Page</button>
        <div id="articleTestOutput"></div>
    </div>
    
    <div class="test-section">
        <h2>URL Normalization Test</h2>
        <button onclick="testUrlNormalization()">Test URL Normalization</button>
        <div id="urlTestOutput"></div>
    </div>
    
    <div class="test-section">
        <h2>Like/Dislike Test</h2>
        <div id="testArticle">
            <h3>Test Article</h3>
            <p>This is a test article to check like/dislike functionality.</p>
            <button class="like-btn" onclick="testLike()">üëç Like</button>
            <button class="dislike-btn" onclick="testDislike()">üëé Dislike</button>
            <div id="likeCount">Likes: 0</div>
            <div id="dislikeCount">Dislikes: 0</div>
        </div>
    </div>

    <script>
        // Like/Dislike tracking
        let userLikes = JSON.parse(localStorage.getItem('userLikes')) || {};
        let userDislikes = JSON.parse(localStorage.getItem('userDislikes')) || {};
        
        function checkLocalStorage() {
            const articles = JSON.parse(localStorage.getItem('articles')) || [];
            const userLikes = JSON.parse(localStorage.getItem('userLikes')) || {};
            const userDislikes = JSON.parse(localStorage.getItem('userDislikes')) || {};
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            let output = `
                <h3>LocalStorage Contents:</h3>
                <p><strong>Articles:</strong> ${articles.length} articles</p>
                <p><strong>User Likes:</strong> ${Object.keys(userLikes).length} articles liked</p>
                <p><strong>User Dislikes:</strong> ${Object.keys(userDislikes).length} articles disliked</p>
                <p><strong>Current User:</strong> ${currentUser ? currentUser.name : 'Not logged in'}</p>
            `;
            
            if (articles.length > 0) {
                output += '<h4>Articles:</h4><ul>';
                articles.forEach((article, index) => {
                    output += `<li><span class="article-link" onclick="testArticleDetail('${article.url}')">${article.title}</span> - ${article.url}</li>`;
                });
                output += '</ul>';
            }
            
            document.getElementById('localStorageOutput').innerHTML = output;
        }
        
        function testArticleDetail(url) {
            if (url) {
                const testUrl = `article-detail.html?url=${encodeURIComponent(url)}`;
                document.getElementById('articleTestOutput').innerHTML = `
                    <p>Testing URL: <a href="${testUrl}" target="_blank">${testUrl}</a></p>
                `;
            } else {
                document.getElementById('articleTestOutput').innerHTML = `
                    <p>No URL provided for testing</p>
                `;
            }
        }
        
        function testUrlNormalization() {
            const testUrls = [
                'https://scitechdaily.com/columbia-scientists-made-a-gel-from-yogurt-that-heals-tissue-and-it-works/',
                'https://scitechdaily.com/columbia-scientists-made-a-gel-from-yogurt-that-heals-tissue-and-it-works',
                'https://example.com/test/',
                'https://example.com/test'
            ];
            
            let output = '<h4>URL Normalization Results:</h4><ul>';
            testUrls.forEach(url => {
                const normalized = normalizeUrl(url);
                output += `<li>Original: ${url}<br>Normalized: ${normalized}</li>`;
            });
            output += '</ul>';
            
            document.getElementById('urlTestOutput').innerHTML = output;
        }
        
        function normalizeUrl(url) {
            try {
                const urlObj = new URL(url);
                let normalized = `${urlObj.protocol}//${urlObj.hostname}${urlObj.pathname}`;
                normalized = normalized.replace(/\/$/, '');
                return normalized.toLowerCase();
            } catch (error) {
                return url.toLowerCase();
            }
        }
        
        function addTestArticle() {
            const articles = JSON.parse(localStorage.getItem('articles')) || [];
            const testArticle = {
                title: "Test Article",
                url: "https://example.com/test",
                summary: "This is a test article for testing like/dislike functionality.",
                source: "Example.com",
                date: new Date().toLocaleDateString(),
                dateAdded: new Date().toISOString(),
                ticker: 1,
                likes: 0,
                dislikes: 0
            };
            
            articles.push(testArticle);
            localStorage.setItem('articles', JSON.stringify(articles));
            alert('Test article added!');
            checkLocalStorage();
        }
        
        function clearLocalStorage() {
            localStorage.clear();
            alert('LocalStorage cleared!');
            checkLocalStorage();
        }
        
        function testLike() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                alert('Please log in first!');
                return;
            }
            
            const articleUrl = "https://example.com/test";
            
            // Remove from dislikes if previously disliked
            if (userDislikes[articleUrl] && userDislikes[articleUrl].includes(currentUser.id)) {
                userDislikes[articleUrl] = userDislikes[articleUrl].filter(id => id !== currentUser.id);
                if (userDislikes[articleUrl].length === 0) {
                    delete userDislikes[articleUrl];
                }
                localStorage.setItem('userDislikes', JSON.stringify(userDislikes));
            }
            
            // Toggle like
            if (!userLikes[articleUrl]) {
                userLikes[articleUrl] = [];
            }
            
            const userIndex = userLikes[articleUrl].indexOf(currentUser.id);
            if (userIndex === -1) {
                // Add like
                userLikes[articleUrl].push(currentUser.id);
                alert('Article liked!');
            } else {
                // Remove like
                userLikes[articleUrl].splice(userIndex, 1);
                if (userLikes[articleUrl].length === 0) {
                    delete userLikes[articleUrl];
                }
                alert('Like removed.');
            }
            
            localStorage.setItem('userLikes', JSON.stringify(userLikes));
            updateCounts();
        }
        
        function testDislike() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                alert('Please log in first!');
                return;
            }
            
            const articleUrl = "https://example.com/test";
            
            // Remove from likes if previously liked
            if (userLikes[articleUrl] && userLikes[articleUrl].includes(currentUser.id)) {
                userLikes[articleUrl] = userLikes[articleUrl].filter(id => id !== currentUser.id);
                if (userLikes[articleUrl].length === 0) {
                    delete userLikes[articleUrl];
                }
                localStorage.setItem('userLikes', JSON.stringify(userLikes));
            }
            
            // Toggle dislike
            if (!userDislikes[articleUrl]) {
                userDislikes[articleUrl] = [];
            }
            
            const userIndex = userDislikes[articleUrl].indexOf(currentUser.id);
            if (userIndex === -1) {
                // Add dislike
                userDislikes[articleUrl].push(currentUser.id);
                alert('Article disliked.');
            } else {
                // Remove dislike
                userDislikes[articleUrl].splice(userIndex, 1);
                if (userDislikes[articleUrl].length === 0) {
                    delete userDislikes[articleUrl];
                }
                alert('Dislike removed.');
            }
            
            localStorage.setItem('userDislikes', JSON.stringify(userDislikes));
            updateCounts();
        }
        
        function updateCounts() {
            const articleUrl = "https://example.com/test";
            const likeCount = userLikes[articleUrl] ? userLikes[articleUrl].length : 0;
            const dislikeCount = userDislikes[articleUrl] ? userDislikes[articleUrl].length : 0;
            
            document.getElementById('likeCount').textContent = `Likes: ${likeCount}`;
            document.getElementById('dislikeCount').textContent = `Dislikes: ${dislikeCount}`;
        }
        
        // Initialize counts
        updateCounts();
        
        // Check localStorage on page load
        checkLocalStorage();
    </script>
</body>
</html> 