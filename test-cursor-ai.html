<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cursor AI - BMECom</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .test-section h3 {
            color: #34495e;
            margin-top: 0;
        }
        input[type="text"], input[type="url"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .loading {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .status {
            font-weight: bold;
            margin: 10px 0;
        }
        .url-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .url-input input {
            flex: 1;
        }
        .sample-urls {
            margin: 15px 0;
        }
        .sample-urls button {
            background-color: #95a5a6;
            margin: 2px;
            padding: 8px 12px;
            font-size: 14px;
        }
        .sample-urls button:hover {
            background-color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† Test Cursor AI Content Reading</h1>
        
        <div class="test-section">
            <h3>üîß Cursor AI Configuration</h3>
            <div class="status" id="cursorStatus">Checking Cursor AI status...</div>
            <input type="text" id="cursorApiKey" placeholder="Enter Cursor AI API Key" />
            <button onclick="configureCursorAI()">Configure Cursor AI</button>
            <button onclick="checkCursorStatus()">Check Status</button>
        </div>

        <div class="test-section">
            <h3>üîç Test URL Content Reading</h3>
            <p>This test will fetch the actual content from a URL and send it to Cursor AI for analysis.</p>
            
            <div class="sample-urls">
                <strong>Sample URLs to test:</strong><br>
                <button onclick="setSampleUrl('https://www.nature.com/articles/s41551-023-01083-5')">Nature Biomedical Engineering</button>
                <button onclick="setSampleUrl('https://www.sciencedirect.com/science/article/abs/pii/S0142961223001234')">Science Direct</button>
                <button onclick="setSampleUrl('https://ieeexplore.ieee.org/document/9876543')">IEEE</button>
                <button onclick="setSampleUrl('https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1234567/')">PubMed Central</button>
            </div>
            
            <div class="url-input">
                <input type="url" id="testUrl" placeholder="Enter article URL to test" />
                <button onclick="testCursorAI()">Test Cursor AI</button>
            </div>
            
            <div id="testResult"></div>
        </div>

        <div class="test-section">
            <h3>üìä Test Results</h3>
            <div id="testResults"></div>
        </div>
    </div>

    <script>
        // Load Cursor AI configuration
        let cursorApiKey = localStorage.getItem('cursorAiApiKey') || '';
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('cursorApiKey').value = cursorApiKey;
            checkCursorStatus();
        });

        function configureCursorAI() {
            const apiKey = document.getElementById('cursorApiKey').value.trim();
            if (apiKey) {
                localStorage.setItem('cursorAiApiKey', apiKey);
                cursorApiKey = apiKey;
                showResult('Cursor AI API key configured successfully!', 'success');
                checkCursorStatus();
            } else {
                showResult('Please enter a valid API key', 'error');
            }
        }

        function checkCursorStatus() {
            const apiKey = localStorage.getItem('cursorAiApiKey');
            const statusElement = document.getElementById('cursorStatus');
            
            if (apiKey && apiKey.length > 0) {
                statusElement.innerHTML = '‚úÖ Cursor AI: Configured with API key';
                statusElement.style.color = '#155724';
            } else {
                statusElement.innerHTML = '‚ùå Cursor AI: No API key configured';
                statusElement.style.color = '#721c24';
            }
        }

        function setSampleUrl(url) {
            document.getElementById('testUrl').value = url;
        }

        async function testCursorAI() {
            const url = document.getElementById('testUrl').value.trim();
            if (!url) {
                showResult('Please enter a URL to test', 'error');
                return;
            }

            if (!cursorApiKey) {
                showResult('Please configure Cursor AI API key first', 'error');
                return;
            }

            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div class="loading">üîÑ Testing Cursor AI with URL content reading...</div>';

            try {
                console.log('üß™ Testing Cursor AI with URL:', url);
                
                // Test the improved generateWithCursorAI function
                const result = await generateWithCursorAI(url);
                
                if (result) {
                    const resultHtml = `
                        <div class="success">
                            <strong>‚úÖ Cursor AI Test Successful!</strong><br><br>
                            <strong>Generated Title:</strong><br>
                            ${result.title}<br><br>
                            <strong>Generated Abstract:</strong><br>
                            ${result.summary}
                        </div>
                    `;
                    resultDiv.innerHTML = resultHtml;
                    
                    // Add to test results
                    addTestResult(url, 'SUCCESS', result);
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå Cursor AI failed to generate content</div>';
                    addTestResult(url, 'FAILED', null);
                }
            } catch (error) {
                console.error('Test error:', error);
                resultDiv.innerHTML = `<div class="error">‚ùå Test failed: ${error.message}</div>`;
                addTestResult(url, 'ERROR', error.message);
            }
        }

        async function generateWithCursorAI(url) {
            try {
                console.log('üîç Cursor AI: Fetching content from URL:', url);
                
                // First, fetch the actual article content from the URL
                const corsProxy = 'https://api.allorigins.win/raw?url=';
                const articleResponse = await fetch(corsProxy + encodeURIComponent(url));
                
                if (!articleResponse.ok) {
                    console.error('‚ùå Cursor AI: Failed to fetch article content');
                    throw new Error('Failed to fetch article content');
                }
                
                const articleContent = await articleResponse.text();
                console.log('üìÑ Cursor AI: Successfully fetched article content, length:', articleContent.length);
                
                // Clean the content to extract meaningful text
                const parser = new DOMParser();
                const doc = parser.parseFromString(articleContent, 'text/html');
                
                // Remove script and style elements
                const scripts = doc.querySelectorAll('script, style, nav, header, footer, .ad, .advertisement');
                scripts.forEach(el => el.remove());
                
                // Extract text content from body
                const bodyText = doc.body ? doc.body.textContent || doc.body.innerText || '' : '';
                const titleText = doc.title || '';
                
                // Clean and limit the content
                const cleanText = (bodyText + ' ' + titleText)
                    .replace(/\s+/g, ' ')
                    .replace(/[^\w\s.,!?-]/g, ' ')
                    .trim()
                    .substring(0, 8000); // Limit to 8000 characters
                
                console.log('üßπ Cursor AI: Cleaned content length:', cleanText.length);
                
                // Now send the actual article content to Cursor AI
                const response = await fetch('https://api.cursor.sh/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${cursorApiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [{
                            role: 'system',
                            content: 'You are a biomedical engineering expert. Analyze the provided article content and generate a unique title and comprehensive abstract (300-500 words) that accurately reflects the specific content and findings of that article. Focus on the actual research, methodology, and results. Make it specific to the article, not generic.'
                        }, {
                            role: 'user',
                            content: `Article URL: ${url}\n\nArticle Content:\n${cleanText}\n\nBased on this content, provide:\n1. A specific, descriptive title (not generic)\n2. A detailed abstract that captures the unique aspects of this research`
                        }],
                        max_tokens: 1000
                    })
                });
                
                const data = await response.json();
                if (data.choices && data.choices[0]) {
                    const content = data.choices[0].message.content;
                    const lines = content.split('\n');
                    const title = lines.find(line => line.includes('Title:') || line.includes('1.'))?.replace(/^.*?[:.]\s*/, '') || '';
                    const summary = lines.slice(lines.findIndex(line => line.includes('Abstract:') || line.includes('2.')) + 1).join('\n').trim();
                    
                    console.log('‚úÖ Cursor AI: Successfully generated title and abstract');
                    return { title, summary };
                } else {
                    throw new Error('No response from Cursor AI');
                }
            } catch (error) {
                console.error('‚ùå Cursor AI error:', error);
                throw error;
            }
        }

        function addTestResult(url, status, result) {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            
            let resultText = '';
            if (status === 'SUCCESS') {
                resultText = `Title: ${result.title}\nAbstract: ${result.summary}`;
            } else if (status === 'ERROR') {
                resultText = `Error: ${result}`;
            } else {
                resultText = 'No result generated';
            }
            
            const resultHtml = `
                <div class="result ${status === 'SUCCESS' ? 'success' : 'error'}">
                    <strong>${timestamp} - ${status}</strong><br>
                    <strong>URL:</strong> ${url}<br>
                    <strong>Result:</strong><br>
                    ${resultText}
                </div>
            `;
            
            resultsDiv.innerHTML = resultHtml + resultsDiv.innerHTML;
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }
    </script>
</body>
</html> 